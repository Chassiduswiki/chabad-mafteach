# Chabad Mafteach Frontend Roadmap

## Current Status
- ‚úÖ Topics pages simplified to use minimal Directus fields (canonical_title, topic_type, description).
- ‚úÖ **TypeScript schema aligned with new Directus data model** (Dec 8, 2025).
- ‚úÖ Tanya reader now fetches from Directus (paragraphs/statements) instead of hardcoded data.
- ‚úÖ Search API stabilized with error handling for permissions.
- ‚úÖ Mobile search modal layout improved.
- ‚úÖ Legacy type aliases added for backward compatibility (Sefer‚ÜíDocument, Location‚ÜíParagraph, etc.).
- ‚úÖ **Premium BookReader component created** - transforms seforim page into professional reading experience (Dec 8, 2025).
- ‚úÖ **Seforim UX issues resolved** - fixed z-index, mobile popup, click-to-close functionality (Dec 8, 2025).
- ‚è≥ **Next: Pick one track below and execute.**

## Schema Migration Notes (Dec 8, 2025)
The frontend TypeScript types now match the new Directus schema:
- **Collections**: `documents`, `paragraphs`, `statements`, `topics`, `statement_topics`, `sources`, `source_links`, `translations`
- **Removed**: `seforim`, `locations`, `texts`, `topic_citations` (replaced with new collections)
- **See**: `Documentation/New-directus-data-model.md` for complete schema reference

---

## TRACK 1: Topics Detail Page (Unblock everything else)

**Goal**: Make `/topics/[slug]` simple, fast, and honest about what data exists.

### Phase 1a: MVP Detail Page (IMMEDIATE)
- [x] Simplify `TopicHeader` to show only: title (canonical_title), category (topic_type), short description.
- [x] Remove or feature-flag `BoundariesTab`, `SourcesTab`, `RelatedTab` from `TopicTabs` (mark as "Coming soon").
- [x] Remove `TopicSidebar` from detail page layout.
- [x] Test: `/topics/[slug]` loads fast, renders cleanly on desktop + mobile, never shows broken/empty sections.

### Phase 1b: Rich Content Fields (After Phase 1a)
- [ ] Add to Directus `topics`: `practical_takeaways`, `historical_context` (rich text fields). Overview and article not needed.
- [ ] Wire `TopicOverview` to render these fields when present.
- [ ] Update `TopicTabs` to conditionally show tabs only if content exists.

### Phase 1c: Boundaries & Relationships (After Phase 1b)
- [ ] Add to Directus `topics`: `definition_positive`, `definition_negative` (rich text).
- [ ] Wire `BoundariesTab` to render these.
- [ ] Implement `topic_relationships` query and wire `RelatedTab` + `TopicSidebar`.

### Phase 1d: Citations & Sources (After Phase 1c)
- [ ] Redesign `SourcesTab` to query `statements` tagged with topic (via `statement_topics`), group by source.
- [ ] Ensure Directus permissions allow static token to read `statements`, `sources`, `source_links`.

---

## TRACK 2: Search (Topics-first, then Seforim)

**Goal**: Make search feel responsive and reliable for topics, then extend to seforim.

### Phase 2a: Topics Search Feel (IMMEDIATE)
- [x] Audit `/api/search` topics filter: decide whether to fetch broader set + rely on Fuse, or expand server-side filter to include `slug` + future translation fields.
- [x] Test: typing a topic's English name reliably returns that topic (no vanishing as you add letters).
- [x] Update `CommandMenu` to show topic results with clear category/type badge.

### Phase 2b: Seforim Search (After 2a)
- [ ] Finalize where seforim live: `documents` (current) or dedicated `seforim` collection.
- [ ] Ensure `/api/search` queries the right collection and handles permissions gracefully.
- [ ] Test: searching "Tanya" or other sefer titles returns results in Sources section.

### Phase 2c: Mobile Search UX (After 2b)
- [ ] Convert `CommandMenu` on small screens to a true **bottom sheet** (full-height, swipe-down to close).
- [ ] Add larger touch targets and clearer result type differentiation.
- [ ] Test on real mobile device: open, search, select, close all feel smooth.

---

## TRACK 3: TorahReader (Tanya ‚Üí Generic)

**Goal**: Generalize the Tanya prototype into a reusable reader for any sefer.

### Phase 3a: Extract & Generalize (IMMEDIATE)
- [x] Created advanced TorahReader in `/seforim/[seferId]/page.tsx` with virtual scrolling, citation handling, settings, and mobile optimization
- [x] Generalized TorahReader component (`/components/TorahReader.tsx`) for flexible content structures
- [x] Integrated Directus data fetching for all sefer content
- [x] Tested `/seforim/[seferId]` routes work for any document type
- [x] Created comprehensive documentation (`TORAH_READER_DOCUMENTATION.md`) with usage examples, API integration, and future extensibility

### Phase 3b: Directus Modeling (After 3a)
- [x] Model `documents` (seforim) ‚Üí `paragraphs` (chapters/sections) ‚Üí `statements` (lines/blocks) in Directus. **DONE**
- [ ] Add `translations` collection entries for Hebrew/English pairs.
- [x] Wire `[perek]/page.tsx` to fetch from Directus instead of local file. **DONE** (Dec 8, 2025)

### Phase 3c: Commentary & Translation UI (After 3b)
- [ ] Design UI for showing Hebrew + English together (toggle or side-by-side).
- [ ] Add support for inline commentary blocks (type: 'commentary' in statements).
- [x] ~~Test: reader shows Hebrew, user can toggle to English, commentary appears inline or in sidebar.~~ **PARTIAL**: Reader shows Hebrew beautifully with premium UX, translation toggle not yet implemented.

---

## TRACK 5: Content Editor (Lower priority, after core tracks)

**Goal**: Build a WYSIWYG editor for content creators to easily edit topics and books, aligned with the current Directus model. Behind authentication with Editor role.

### Phase 5a: MVP Editor Forms (After Phase 1b)
- [x] Create `/editor/topics/[slug]` page for editing topic definitions
- [x] Form fields for: canonical_title, description, topic_type, definition_positive, definition_negative
- [x] Save to Directus via API with authentication
- [x] Basic validation and error handling
- [x] Redirect to topic page after save
- [x] Create `/editor/topics` page for topic management with search and filtering

### Phase 5b: Rich Text & Order Management (After Phase 5a)
- [ ] Add rich-text WYSIWYG for `description` and metadata fields (Markdown/HTML support).
- [ ] Build Paragraphs editor with order-key generation (auto-increment LexoRank).
- [ ] Build Statements editor with inline topic tagging interface.
- [ ] Add bulk import/export for JSON files (aligned with DATA_INGESTION_SPEC_v2).
- [ ] Test: Editors can structure a full sefer hierarchy and tag statements.

### Phase 5c: Translation & Review UI (After Phase 5b)
- [ ] Add side-by-side translation interface for statements/paragraphs.
- [ ] Build review workflow for translation quality levels.
- [ ] Add preview mode to see how content renders in frontend.
- [ ] Test: Translators can work efficiently and preview changes.

---

## TRACK 6: Editor Refactor (Phase 2 - COMPLETED)

**Goal**: Clean up the codebase now that citation feature is working.

### Phase 2.1: Extract Citation Plugin (COMPLETED)
- [x] Move citation logic from `ProseEditor.tsx` into a self-contained ProseMirror plugin in `components/editor/plugins/citations/`
- [x] Include: cmdk palette, suggestion trigger, node insertion logic
- [x] Update ProseEditor to use the new comprehensive citation plugin
- [x] Test: Citation workflow still works after extraction

### Phase 2.2: Extract `useEditor` Hook (COMPLETED)
- [x] Review current `useEditor` hook implementation
- [x] Consolidate any remaining data-fetching, state management, and save logic from `app/editor/page.tsx`
- [x] Ensure page component is clean and isolated editor logic

---

## üö® CRITICAL INFRASTRUCTURE ISSUES (URGENT - BLOCKING EDITOR)

### **Directus Permissions Configuration (REQUIRED)**
**Status:** ‚ùå NOT DONE - BLOCKING EDITOR FUNCTIONALITY
**Impact:** Editor completely broken - 403 Forbidden on all API calls
**Action Required:**
- Login to Directus Admin: https://directus-production-20db.up.railway.app/admin
- Go to Settings ‚Üí Access Control
- Create/configure "Public" role with READ permissions for:
  - documents collection (all fields)
  - topics collection (all fields) 
  - sources collection (all fields)
  - authors collection (all fields)
- Assign static token `Y2uEb9-2oyj8-DEn5eeJypUw7xUGuR96` to Public role
- Test: Editor should load StructureSidebar and citations without 403 errors

**Next Agent:** Check if this has been resolved before proceeding with any editor work!

---

---

## TRACK 4: Infrastructure & Testing (Lower priority, do in parallel)

- [x] Decide final Directus public-access model: which collections/fields readable by static token. **DONE** (JWT auth implemented)
- [ ] Implement + test permission changes in staging before production.
- [x] Add integration tests for topics, search, and TorahReader to catch regressions. **FOUNDATION COMPLETE** (Jest setup ready, complex tests deferred)
- [x] Document the new topics data model and frontend mapping in repo docs. **DONE** (See `lib/types/index.ts` and `Documentation/New-directus-data-model.md`)
- [ ] Re-enable term-linking pipeline (`linkTerms`) once topics schema is stable (Phase 1c).
- [x] Align TypeScript types with new Directus schema. **DONE** (Dec 8, 2025)
- [x] Set up Jest testing framework with performance monitoring. **DONE** (Bundle: 1.12 MB JS, 1.45 MB total)

---

## Component Cleanup Tasks (Added Dec 8, 2025)

**Priority**: High - Remove unused code to improve maintainability

1. **[HIGH] Remove 3 unused components** - Immediate cleanup to reduce bundle size:
   - `button` (UI component) - **REMOVED**
   - `TanyaChapterReader` - **REMOVED** 
   - `TopicOverview` - **REMOVED**

2. **[HIGH] Complete TopicTabs implementation** - Currently only renders OverviewTab, needs full tab functionality

3. **[MEDIUM] Reconfigure topic components for new DB schema** - Future implementation:
   - `TopicArticle` - Connect to Document + paragraph/statement system
   - `RelatedTab` - Link to existing related topics in DB
   - `SourcesTab` - Reconfigure for new Directus schema
   - `TopicSidebar` - Shelve for future use

4. **[MEDIUM] Review and split large components** - Consider breaking down:
   - `BookReader` (346 lines) - consider lazy loading

**Goal**: Secure the application against unauthorized access and ensure stability under load.

### Phase 7a: Authentication & Authorization (High Priority - CRITICAL ISSUES FOUND)
- [x] **Implement Auth Layer**: Integrate NextAuth.js or Directus Auth for API routes.
- [x] **Secure API Routes**: Protect /api/ingest/* and /api/statements/break against unauthenticated access.
- [x] **Token Management**: Ensure no write-access tokens are ever exposed to the client (process check).
- [ ] **üî¥ CRITICAL: Remove Hardcoded Demo Users** - `auth/login/route.ts` contains hardcoded bcrypt users - PRODUCTION SECURITY RISK
- [ ] **üî¥ CRITICAL: Implement Refresh Tokens** - 24-hour token expiration without refresh mechanism
- [ ] **üî¥ CRITICAL: Fix JWT_SECRET Fallback** - `lib/auth.ts` has default JWT_SECRET 'your-secret-key-change-in-production'
- [ ] **üî¥ CRITICAL: Add Rate Limiting** - No rate limiting on auth endpoints, vulnerable to brute force
- [ ] **API Structure Issues**: Found in audit, including missing error handling and inconsistent API route naming

---

## TRACK 4: Infrastructure & Testing (Lower priority, do in parallel)

- [x] Decide final Directus public-access model: which collections/fields readable by static token. **DONE** (JWT auth implemented)
- [ ] Implement + test permission changes in staging before production.
- [x] Add integration tests for topics, search, and TorahReader to catch regressions. **FOUNDATION COMPLETE** (Jest setup ready, complex tests deferred)
- [x] Document the new topics data model and frontend mapping in repo docs. **DONE** (See `lib/types/index.ts` and `Documentation/New-directus-data-model.md`)
- [ ] Re-enable term-linking pipeline (`linkTerms`) once topics schema is stable (Phase 1c).
- [x] Align TypeScript types with new Directus schema. **DONE** (Dec 8, 2025)
- [x] Set up Jest testing framework with performance monitoring. **DONE** (Bundle: 1.12 MB JS, 1.45 MB total)

---

## TRACK 8: Innovation & Features (Future Vision)

**Goal**: Transform the platform into a dynamic, collaborative scholar tool.

### Phase 8a: Advanced Editor Features
- [ ] **Collaborative Editing**: Real-time multi-user editing using ProseMirror + WebSockets.
- [ ] **AI Citation Verification**: Verify detected citations against external APIs (Sefaria, HebrewBooks).

### Phase 8b: Visualization & Discovery
- [ ] **Interactive Graph**: Visualize topic connections using react-force-graph-2d.
- [ ] **Source-First View**: Browse entire works (e.g. Tanya) with overlay annotations.
- [ ] **Personalized Learning**: Recommendation engine based on user reading history.

---

## TRACK 9: UX Audit & Fixes (Immediate Priority)

**Goal**: Fix critical user experience issues identified in comprehensive audit.

### Phase 9a: Critical Flow Blockers
- [ ] **Fix Article tab dead end** - Replace "Coming Soon" with functional content or clear next steps (HIGH PRIORITY - users hit dead end)
- [ ] **üî¥ CRITICAL: Fix Orphaned Records** - statement_topics table contains 7 records referencing non-existent statement IDs (62, 65, 66, 67, 69) - causing empty article content
- [x] **Implement citation modal viewer** - Complete citation click handling with modal showing source details (BROKEN user interaction)

### Phase 9b: Navigation & Discovery Issues
- [x] **Audit navigation links** - Ensure all header navigation links are functional (/topics, /seforim, /explore, /collections)
- [x] **Improve search reliability** - Fix vanishing results, ensure topics/authors/sources discoverable
- [ ] **üî¥ CRITICAL: Add Rate Limiting** - No rate limiting on search endpoints, vulnerable to abuse

### Phase 9c: Visual & Mobile Polish
- [x] **Fix dark mode styling** - Align book text page gradients/colors with main UI theme in dark mode
- [x] **Replace Collections placeholder** - Implement functional bookmarks/saved items system
- [x] **Audit mobile UX** - Test bottom sheets, touch targets, swipe gestures, navigation flow

### Phase 9d: System Reliability
- [ ] **Audit editor permissions** - Resolve 403 errors, ensure proper Directus role configuration for editor functionality

### Phase 9e: Quick Wins (< 2 hours each)
- [x] **Improve Article empty state** - Replace "Coming Soon" dead end with topic description and helpful next steps
- [x] **Basic Collections functionality** - Implement localStorage bookmarking for topics with simple UI
- [x] **Home page onboarding hints** - Add subtle guidance for first-time users
- [ ] **Navigation link testing** - Verify all header links work, fix any 404s
- [ ] **Mobile search UX** - Test and fix bottom sheet behavior, touch targets

---

## TRACK 10: Internationalization & Analytics (COMPLETED - Dec 10, 2025)

**Goal**: Implement bilingual support for topics and comprehensive analytics for understanding user language preferences and behavior.

### Phase 10a: Bilingual Topic Support (COMPLETED)
- ‚úÖ **Directus Schema**: Added `canonical_title_en` and `canonical_title_transliteration` fields to topics collection
- ‚úÖ **API Updates**: Modified topics API to serve bilingual data with smart priority (English ‚Üí Transliteration ‚Üí Hebrew)
- ‚úÖ **TypeScript Types**: Updated interfaces to support new multilingual fields
- ‚úÖ **Smart Display Logic**: Implemented fallback chain for optimal user experience

### Phase 10b: User Behavior Analytics (COMPLETED)
- ‚úÖ **Vercel Analytics Integration**: Added comprehensive tracking for page views and custom events
- ‚úÖ **Bilingual Analytics Suite**: 30+ custom events tracking language usage, switches, and accessibility barriers
- ‚úÖ **React Hooks**: Created `useBilingualAnalytics` and `useLanguageSwitchTracking` for component integration
- ‚úÖ **Privacy-First Approach**: All analytics respect user privacy and GDPR compliance

### Phase 10c: User Feedback Systems (COMPLETED)
- ‚úÖ **Translation Feedback Component**: Inline rating system for translation quality assessment
- ‚úÖ **Translation Survey System**: Multi-step survey for gathering comprehensive user preferences
- ‚úÖ **Accessibility Tracking**: Monitor language barriers and usability issues
- ‚úÖ **Data-Driven Insights**: Foundation for understanding translation priorities and user needs

### Phase 10d: Enhanced Analytics Infrastructure (RECOMMENDED)
- üîÑ **Umami Deployment**: Self-hosted analytics dashboard for visual bilingual insights
- üîÑ **Custom Admin Dashboard**: TailAdmin-based interface for translation metrics and survey responses
- üîÑ **Real-time Monitoring**: Live tracking of language preferences and content engagement

### Key Achievements:
- **Data-Driven Decisions**: Analytics foundation to answer "Do users want Hebrew-primary?" and "Which content needs translation?"
- **Scalable Architecture**: Minimal bilingual implementation ready for expansion based on user feedback
- **Privacy Compliance**: Self-hosted analytics respecting Jewish learning platform sensitivities
- **User-Centric Design**: Smart language fallback prioritizing accessibility while preserving Hebrew authenticity

### Next Steps:
1. **Deploy Umami analytics** for visual dashboards (5-10 minutes on Railway)
2. **Add English translations** for existing 3 topics in Directus admin
3. **Monitor bilingual user behavior** to inform content translation priorities
4. **Scale based on data**: Expand to paragraphs/statements if user demand justifies

---

## TRACK 11: Performance & Bundle Optimization (Future)

**Goal**: Optimize application performance and bundle size for better user experience.

### Phase 11a: Bundle Analysis & Optimization
- [ ] **Audit bundle size** - Analyze current 1.12 MB JS bundle and identify optimization opportunities

## TRACK 9: UX Audit & Fixes (Immediate Priority)

**Goal**: Fix critical user experience issues identified in comprehensive audit.

### Phase 9a: Critical Flow Blockers
- [ ] **Fix Article tab dead end** - Replace "Coming Soon" with functional content or clear next steps (HIGH PRIORITY - users hit dead end)
- [ ] **üî¥ CRITICAL: Fix Orphaned Records** - statement_topics table contains 7 records referencing non-existent statement IDs (62, 65, 66, 67, 69) - causing empty article content
- [x] **Implement citation modal viewer** - Complete citation click handling with modal showing source details (BROKEN user interaction)

### Phase 9b: Navigation & Discovery Issues
- [x] **Audit navigation links** - Ensure all header navigation links are functional (/topics, /seforim, /explore, /collections)
- [x] **Improve search reliability** - Fix vanishing results, ensure topics/authors/sources discoverable
- [ ] **üî¥ CRITICAL: Add Rate Limiting** - No rate limiting on search endpoints, vulnerable to abuse

### Phase 9c: Visual & Mobile Polish
- [x] **Fix dark mode styling** - Align book text page gradients/colors with main UI theme in dark mode
- [x] **Replace Collections placeholder** - Implement functional bookmarks/saved items system
- [x] **Audit mobile UX** - Test bottom sheets, touch targets, swipe gestures, navigation flow

### Phase 9d: System Reliability
- [ ] **Audit editor permissions** - Resolve 403 errors, ensure proper Directus role configuration for editor functionality

### Phase 9e: Quick Wins (< 2 hours each)
- [x] **Improve Article empty state** - Replace "Coming Soon" dead end with topic description and helpful next steps
- [x] **Basic Collections functionality** - Implement localStorage bookmarking for topics with simple UI
- [x] **Home page onboarding hints** - Add subtle guidance for first-time users
- [ ] **Navigation link testing** - Verify all header links work, fix any 404s
- [ ] **Mobile search UX** - Test and fix bottom sheet behavior, touch targets

---

## TRACK 12: Sefaria-Inspired Long-Term Roadmap (18 Months)

**Goal**: Transform Chabad Mafteach into a comprehensive learning ecosystem inspired by Sefaria's features while maintaining Chabad philosophy focus.

### Phase 1: Enhanced Reading & Content (Months 1-3)

#### Split Pane & Translation Features
**Timeline**: Month 1
**Status**: Ready for implementation

```typescript
// app/components/TextComparison.tsx
export function TextComparison({ leftContent, rightContent, syncScroll = true }) {
  const [splitRatio, setSplitRatio] = useState(50)
  const [scrollPosition, setScrollPosition] = useState(0)
  
  return (
    <div className="comparison-view">
      <Panel content={leftContent} ratio={splitRatio} />
      <Resizer onChange={setSplitRatio} />
      <Panel content={rightContent} ratio={100-splitRatio} />
    </div>
  )
}
```

#### Source Sheets Collections
**Timeline**: Months 1-2

```typescript
// app/types/sheets.ts
export interface SourceSheet {
  id: string
  title: string
  author: User
  visibility: 'public' | 'private' | 'shared'
  sources: Array<{
    topicId: string
    statementId: string
    note?: string
    position: number
  }>
  collaborators: User[]
  createdAt: Date
  updatedAt: Date
}
```

#### Topic of the Day
**Timeline**: Month 2

```typescript
// app/lib/daily-topic.ts
export class DailyTopicManager {
  private rotation = ['ahavas-yisroel', 'tefillah', 'tefillah', 'bitul', 'dveikus']
  
  getTopicForDate(date: Date): Topic {
    const dayOfWeek = date.getDay()
    return this.rotation[dayOfWeek % this.rotation.length]
  }
  
  getProgress(userId: string): TopicProgress[] {
    // Track completion across topics
  }
}
```

### Phase 2: User Accounts & Community (Months 4-8)

#### Authentication & User Profiles
**Timeline**: Months 4-5
**Tech**: NextAuth.js + Directus users

```typescript
// app/lib/auth/config.ts
export const authConfig = {
  providers: [GoogleProvider, EmailProvider],
  callbacks: {
    session: async ({ session, token }) => ({
      ...session,
      user: {
        ...session.user,
        role: token.role,
        bookmarks: token.bookmarks
      }
    })
  }
}
```

#### Bookmarking & Personal Library
**Timeline**: Month 5

```typescript
// Directus collection: user_bookmarks
{
  user_id: uuid,
  item_type: 'topic' | 'statement' | 'document',
  item_id: uuid,
  note: text,
  tags: json,
  created_at: timestamp
}
```

#### Collaborative Source Sheets
**Timeline**: Months 6-7
**Features**: Real-time editing, commenting, sharing

#### User-Generated Content Moderation
**Timeline**: Month 8
**Tech**: Directus workflows + custom approval system

### Phase 3: Advanced Learning Features (Months 9-12)

#### Concept Relationship Visualization
**Timeline**: Months 9-10
**Tech**: React Flow or D3.js

```typescript
// app/components/ConceptMap.tsx
export function ConceptMap({ topicId }) {
  const { nodes, edges } = useTopicGraph(topicId)
  
  return (
    <ReactFlow
      nodes={nodes}
      edges={edges}
      nodeTypes={{
        topic: TopicNode,
        concept: ConceptNode,
        person: PersonNode
      }}
      onNodeClick={(node) => navigate(`/topics/${node.id}`)}
    />
  )
}
```

#### Personalized Learning Paths
**Timeline**: Month 11
**Algorithm**: Based on user history, topic difficulty, prerequisites

#### Study Sessions & Progress Tracking
**Timeline**: Month 12
**Features**: Pomodoro timer, streak tracking, achievement system

### Phase 4: API & Developer Ecosystem (Months 13-15)

#### Public REST API
**Timeline**: Months 13-14

```typescript
// pages/api/v1/topics/[id].ts
export default async function handler(req, res) {
  const { id } = req.query
  
  switch (req.method) {
    case 'GET':
      const topic = await getTopicById(id)
      return res.json({ data: topic })
    case 'PUT':
      if (!isAuthenticated(req)) return res.status(401)
      const updated = await updateTopic(id, req.body)
      return res.json({ data: updated })
    default:
      return res.status(405)
  }
}
```

#### GraphQL API Layer
**Timeline**: Month 15
**Benefits**: Flexible queries for complex relationships

#### API Documentation & SDK
**Timeline**: Month 15
**Tools**: OpenAPI spec, Postman collection, JavaScript SDK

### Phase 5: Analytics & Scaling (Months 16-18)

#### Usage Analytics
**Timeline**: Month 16
**Metrics**: Popular topics, user engagement, search patterns

```typescript
// lib/analytics/tracker.ts
export class AnalyticsTracker {
  async trackEvent(event: AnalyticsEvent) {
    await prisma.analyticsEvent.create({
      data: {
        type: event.type,
        userId: event.userId,
        topicId: event.topicId,
        metadata: event.metadata
      }
    })
  }
}
```

#### Performance Monitoring
**Timeline**: Month 17
**Tools**: Vercel Analytics, custom dashboards

#### Mobile App Development
**Timeline**: Months 17-18
**Tech**: React Native or Expo

#### Content Expansion Planning
**Timeline**: Month 18
**Scale**: 50+ topics, user contributions pipeline

### Technical Infrastructure Roadmap

#### Database Evolution
- **Months 1-6**: Optimize PostgreSQL indexes, add full-text search
- **Months 7-12**: Consider Elasticsearch for advanced search
- **Months 13-18**: Evaluate Redis for caching layer

#### Frontend Architecture
- **Months 1-6**: Component library standardization
- **Months 7-12**: Progressive Web App features
- **Months 13-18**: Advanced state management (Zustand/Redux)

#### Backend Enhancements
- **Months 1-6**: API rate limiting, caching
- **Months 7-12**: Background job processing (Bull/Redis)
- **Months 13-18**: Microservices evaluation for heavy processing

### Success Metrics & Milestones

#### Quarterly Goals
- **Q1**: Split pane, translations, basic source sheets
- **Q2**: User accounts, bookmarking, collaborative features  
- **Q3**: Visualization, learning paths, study tracking
- **Q4**: Public API, analytics, mobile planning

#### User Growth Targets
- **Month 6**: 100 active users
- **Month 12**: 500 active users, 1000+ source sheets
- **Month 18**: 2000+ users, established developer community

#### Content Expansion
- **Month 6**: 20 topics completed
- **Month 12**: 40 topics, user contribution pipeline
- **Month 18**: 60+ topics, community-driven content

### Implementation Priority

#### Immediate (Next 2 Weeks)
- **Layered Commentary Interface** - Adapt for 2-3 commentaries per statement
- **Basic Topic Yomi** - Daily topic rotation with 8 core concepts

#### Short-term (Next Month)
- **Chassidic Thinkers Map** - Visual relationships between core Chabad figures
- **Enhanced Search** - Concordance-style results for concepts

#### Medium-term (Next Quarter)
- **Advanced Visualization** - Interactive concept networks
- **Progress Tracking** - Streak counters and achievement systems

Al HaTorah's approach to layered text display and commentator relationships would significantly enhance our platform's depth, while their daily learning programs provide a proven engagement model we can adapt for Chassidic concepts. The key is maintaining our focus on conceptual relationships while adopting their technical approaches for better user experience.

#### Dach.dev Implementation Priority

##### Immediate (Next Week)
- **Error Reporting System** - Add right-click/long-press error reporting
- **Print Functionality** - Basic print layouts for topics

##### Short-term (Next Month)
- **AI Translation Integration** - Start with basic AI translation for new content
- **Progress Tracking** - Add completion indicators to library

##### Medium-term (Next Quarter)
- **Community Contribution Hub** - Structured contribution system
- **Mobile Optimizations** - Enhanced mobile reading experience

Dach.dev's approach is particularly relevant since they're solving the same core problem we are - making Chabad Chassidus accessible. Their AI translation system, community focus, and practical features like printing show a deep understanding of user needs. The key insight is their acknowledgment that AI translations need human validation, which aligns perfectly with our emphasis on accuracy in Chassidic teachings.

#### Tablet.otzar.org Implementation Priority

##### Immediate (Next Week)
- **Status Indicators** - Add comprehensive status system throughout the app
- **View Controls** - Implement basic zoom and full-screen controls

##### Short-term (Next Month)
- **Advanced Layout System** - Add configurable gutters and positioning
- **User Additions** - Basic comment system for community contributions

##### Medium-term (Next Quarter)
- **Multi-Window Interface** - Side-by-side text comparison
- **Collaboration Features** - Advanced user contribution tools

Otzar HaChochma's sophisticated interface design shows incredible attention to detail in text presentation and user interaction. Their status indicators, view controls, and collaborative features provide a master class in creating professional digital text platforms. The key insight is how they balance complexity with usability, offering power users extensive customization while keeping the interface clean for regular users. This level of polish would significantly elevate our Chabad Mafteach platform's user experience.

---

## TRACK 13: Hierarchical Commentary System (December 2025 Design)

**Goal**: Enable proper handling of seforim that are commentaries on other seforim (Rashi on Talmud, incidental commentaries, multi-level commentary chains).

### Commentary Relationship Types
- **Primary Commentary**: Sefer whose main purpose is commenting on another (e.g., Rashi on Talmud)
- **Incidental Commentary**: Commentary appearing within another work ("by-the-way" references)
- **Multi-level Commentary**: Commentary on commentary (e.g., Tosafot on Rashi)

### Proposed Schema Architecture

#### Enhanced Documents Table
```sql
ALTER TABLE documents ADD COLUMN commentary_type VARCHAR(50); -- 'primary_commentary', 'incidental_commentary', 'multi_level'
ALTER TABLE documents ADD COLUMN commentary_level INTEGER DEFAULT 1; -- 1 = base text, 2 = commentary, 3 = commentary on commentary
ALTER TABLE documents ADD COLUMN root_text_id INTEGER REFERENCES documents(id); -- Points to original sefer
```

#### Document Commentary Relationships Table
```sql
CREATE TABLE document_commentary_relationships (
    id SERIAL PRIMARY KEY,
    commentator_document_id INTEGER REFERENCES documents(id), -- Commentary sefer
    target_document_id INTEGER REFERENCES documents(id), -- Sefer being commented on
    relationship_type VARCHAR(50), -- 'primary_commentary', 'incidental_commentary', 'section_commentary'
    target_section VARCHAR(255), -- Which section/part of target document
    commentary_scope VARCHAR(50), -- 'entire_work', 'specific_section', 'verse_by_verse'
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### Implementation Phases

#### Phase 13a: Schema & Types (Month 1)
- [ ] Add commentary fields to documents table via Directus admin
- [ ] Create document_commentary_relationships table
- [ ] Update TypeScript interfaces in `lib/types/index.ts`
- [ ] Add relationship management to Directus admin UI

#### Phase 13b: Data Model & API (Months 2-3)
- [ ] Create API endpoints for commentary relationships:
  - `GET /api/documents/[id]/commentary-chain` - Get full commentary hierarchy
  - `GET /api/documents/[id]/commentaries` - Get all commentaries on this document
  - `POST /api/documents/commentary-relationship` - Create relationship
- [ ] Update existing APIs to include commentary metadata
- [ ] Add validation for commentary relationship integrity

#### Phase 13c: UI Components (Months 4-5)
- [ ] Create `CommentaryChain` component for breadcrumb navigation
- [ ] Implement `MultiLevelDisplay` for side-by-side commentary layout
- [ ] Add commentary relationship management in admin interface
- [ ] Update search to show commentary relationships

#### Phase 13d: Content Integration (Months 6-7)
- [ ] Update scraper to detect and populate commentary relationships
- [ ] Tag existing commentary seforim in database
- [ ] Create migration scripts for existing commentary content
- [ ] Add commentary relationship import/export functionality

### Frontend Display Patterns

#### Commentary Chain Navigation
```typescript
const CommentaryChain = ({ documentId }) => {
  const chain = getCommentaryChain(documentId); // [Base Text] ‚Üí [Rashi] ‚Üí [Tosafot]
  return (
    <div className="commentary-breadcrumb">
      {chain.map((doc, level) => (
        <span key={doc.id}>
          {level > 0 && " ‚Üí "}
          <Link href={`/seforim/${doc.id}`}>
            {doc.title} {getCommentaryBadge(doc.commentary_level)}
          </Link>
        </span>
      ))}
    </div>
  );
};
```

#### Multi-Level Commentary Layout
```typescript
const MultiLevelDisplay = ({ baseText, commentaries }) => {
  const levels = groupCommentariesByLevel(commentaries);

  return (
    <div className="commentary-grid grid-cols-[2fr,1fr,1fr]">
      {/* Base text column */}
      <div className="base-text">{baseText}</div>

      {/* Commentary columns by level */}
      {levels.map(level => (
        <div key={level.number} className="commentary-column">
          <h4>{level.commentatorName}</h4>
          {level.blocks.map(block => (
            <CommentaryBlock key={block.id} block={block} />
          ))}
        </div>
      ))}
    </div>
  );
};
```

### Success Criteria
- **Hierarchical Navigation**: Users can follow commentary chains seamlessly
- **Context Awareness**: Clear indication of commentary level and relationships
- **Citation Integrity**: Proper attribution and linking of commentary sources
- **Scalability**: Support for unlimited commentary levels and relationships

### Integration Points
- **Existing `block_commentaries`**: Continue using for granular commentary on content blocks
- **New `document_commentary_relationships`**: Handle document-level commentary relationships
- **Citation System**: Enhanced to support commentary attribution and chaining

This architecture provides a robust foundation for handling the complex relationships between commentary seforim and their base texts, enabling proper scholarly navigation and citation in Jewish textual studies.

---

## üö® ARCHITECTURAL CONCERNS (REQUIRES DISCUSSION)

### Data Integrity & Statement Synchronization
**Issue**: What happens if text in paragraph changes, will it throw the statement system out of sync?
- **Impact**: Could break citations, references, and user bookmarks
- **Solution Needed**: Version control system for paragraphs/statements
- **Discussion Required**: How to handle text updates without breaking existing references

### Statement-to-Topic Linking Architecture
**Issue**: New version of statements to pull concepts into topics as sources. How to quote multi-page concepts?
- **Impact**: Current statement_topics table only links single statements to topics
- **Solution Needed**: Support for statement ranges, page ranges, or concept spans
- **Discussion Required**: Schema changes for multi-statement topic associations

---

## TRACK 9: UX Audit & Fixes (Immediate Priority)

**Goal**: Fix critical user experience issues identified in comprehensive audit.

### Phase 9a: Critical Flow Blockers
- [ ] **Fix Article tab dead end** - Replace "Coming Soon" with functional content or clear next steps (HIGH PRIORITY - users hit dead end)
- [ ] **üî¥ CRITICAL: Fix Orphaned Records** - statement_topics table contains 7 records referencing non-existent statement IDs (62, 65, 66, 67, 69) - causing empty article content
- [ ] **üî¥ CRITICAL: Fix Schema Migration Issues** - content_blocks replaced paragraphs but statements.block_id may reference old paragraph_id values
- [x] **Implement citation modal viewer** - Complete citation click handling with modal showing source details (BROKEN user interaction)

### Phase 9b: Navigation & Discovery Issues
- [x] **Audit navigation links** - Ensure all header navigation links are functional (/topics, /seforim, /explore, /collections)
- [x] **Improve search reliability** - Fix vanishing results, ensure topics/authors/sources discoverable
- [ ] **üî¥ CRITICAL: Add Rate Limiting** - No rate limiting on search endpoints, vulnerable to abuse

### Phase 9c: Visual & Mobile Polish
- [x] **Fix dark mode styling** - Align book text page gradients/colors with main UI theme in dark mode
- [x] **Replace Collections placeholder** - Implement functional bookmarks/saved items system
- [x] **Audit mobile UX** - Test bottom sheets, touch targets, swipe gestures, navigation flow

### Phase 9d: System Reliability
- [ ] **Audit editor permissions** - Resolve 403 errors, ensure proper Directus role configuration for editor functionality

### Phase 9e: Quick Wins (< 2 hours each)
- [x] **Improve Article empty state** - Replace "Coming Soon" dead end with topic description and helpful next steps
- [x] **Basic Collections functionality** - Implement localStorage bookmarking for topics with simple UI
- [x] **Home page onboarding hints** - Add subtle guidance for first-time users
- [ ] **Navigation link testing** - Verify all header links work, fix any 404s
- [ ] **Mobile search UX** - Test and fix bottom sheet behavior, touch targets

---
