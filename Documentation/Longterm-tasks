## Chabad Mafteach Frontend Roadmap

**Note from critique (Jan 25, 2026):** Infrastructure, Performance, Governance, and SEO are now elevated to first-class priorities to prevent technical debt and ensure public-launch readiness.

## üéØ JANUARY 2026 PIVOT: Focus on Digital Chassidus Encyclopedia
**Goal**: Temporarily hide the "sources" (Seforim/Torah Reader) side of the platform to focus on the core "Digital Chassidus Encyclopedia" (Topics). This ensures a high-quality, focused experience before re-introducing source deep-diving.

### Immediate Actions
- [x] Hide `/seforim` (Sources) and `/explore` from main navigation and homepage.
- [x] Remove "Citations" (Sources) tab from Topic detail pages.
- [ ] Focus content editor and ingestion on Topic definitions and team-written entries.
- [ ] Incorporate team-written encyclopedia entries into the site.

## Current Status
- ‚úÖ Topics pages simplified to use minimal Directus fields (canonical_title, topic_type, description).
- ‚úÖ **TypeScript schema aligned with new Directus data model** (Dec 8, 2025).
- ‚úÖ Tanya reader now fetches from Directus (paragraphs/statements) instead of hardcoded data.
- ‚úÖ Search API stabilized with error handling for permissions.
- ‚úÖ Mobile search modal layout improved.
- ‚úÖ Legacy type aliases added for backward compatibility (Sefer‚ÜíDocument, Location‚ÜíParagraph, etc.).
- ‚úÖ **Premium BookReader component created** - transforms seforim page into professional reading experience (Dec 8, 2025).
- ‚úÖ **Seforim UX issues resolved** - fixed z-index, mobile popup, click-to-close functionality (Dec 8, 2025).
- ‚úÖ **Track 2c: Mobile Search UX Upgrade** - Premium bottom-sheet with swipe gestures & native feel (Dec 24, 2025).
- ‚úÖ **Track 2b: Seforim Search Implementation** - Bilingual discovery (Tanya ‚Üí ◊ú◊ô◊ß◊ï◊ò◊ô ◊ê◊û◊®◊ô◊ù) & expanded collection search.
- ‚úÖ **Premium 404 & Explore Pages** - High-end mobile-first redesigns with glassmorphism (Dec 2025).
- ‚úÖ **Seforim page accessibility fixed** - Resolved TypeError in Directus client initialization (Dec 25, 2025).
- ‚úÖ **Search modal issues resolved** - Fixed navigation to undefined IDs and added mobile Cancel button (Dec 25, 2025).
- ‚úÖ **Track 1, Phase 1d: Citations & Sources** - Statement-first research UI with book grouping (Dec 25, 2025).
- ‚úÖ **Track 11: Explore & Discovery Upgrade** - Passive discovery (Zen) and intentional hubs (Topics) (Dec 25, 2025).
- ‚úÖ **Topic Editor Stabilized** - Resolved hang, fixed paragraphs/statements API, and implemented PATCH/DELETE (Jan 6, 2026).
- ‚úÖ **Search Link Reliability** - Fixed `undefined` document IDs and standardized search URLs (Jan 6, 2026).
- ‚úÖ **Article Tab Visibility** - Fixed `directus-proxy` path reconstruction error (Jan 6, 2026).
- ‚è≥ **Next: Hide source-related UI and focus on encyclopedia content integration.**


## Schema Migration Notes (Dec 8, 2025)
The frontend TypeScript types now match the new Directus schema:
- **Collections**: `documents`, `paragraphs`, `statements`, `topics`, `statement_topics`, `sources`, `source_links`, `translations`
- **Removed**: `seforim`, `locations`, `texts`, `topic_citations` (replaced with new collections)
- **See**: `Documentation/New-directus-data-model.md` for complete schema reference

- [ ] **Accessibility Audit**: Run axe DevTools on every page, fix critical issues. (Blindspot #6)
- [ ] **Internationalization (i18n)**: Plan for Yiddish text rendering and RTL layout switching. (Blindspot #7)
- [ ] **Mobile Strategy**: Decide between Native vs PWA (Push notifications, offline-first). (Blindspot #9)
- [ ] **Content Governance**: Add "draft vs published" status to topics. (Blindspot #4)

## TRACK 17: Infrastructure, Performance & Observability (URGENT)

**Goal**: Ensure the app is fast, reliable, and observable before public launch. (Blindspots #1, #2, #3)

### Phase 17a: Performance & Scalability
- [ ] **Performance Budgets**: Set targets (API <500ms, Page Load <3s).
- [ ] **Pagination & Optimization**: Implement query pagination for large collections (topics/sources).
- [ ] **Caching Layer**: Add Redis caching for Directus queries and AI search.
- [ ] **Asset Optimization**: Optimize image/font delivery via CDN.

### Phase 17b: Observability & Monitoring
- [ ] **Error Tracking**: Integrate Sentry/LogRocket for frontend/backend errors.
- [ ] **Uptime Monitoring**: Set up alerts for Directus API availability.
- [ ] **Error Boundaries**: Implement React Error Boundaries for major UI sections.

### Phase 17c: Data Migration & Versioning
- [ ] **Staging Workflow**: Document and enforce Staging ‚Üí Production sync process.
- [ ] **Automated Backups**: Implement schema/data backups before migrations.
- [ ] **Migration Scripts**: Create dry-run scripts for schema changes.

## TRACK 18: Governance, SEO & Legal (URGENT)

**Goal**: Protect the project legally and ensure it is discoverable. (Blindspots #4, #5, #8)

### Phase 18a: SEO Strategy
- [ ] **Dynamic Metadata**: Implement Next.js Metadata API for all topic pages.
- [ ] **Sitemap & Structured Data**: Generate `sitemap.xml` and Schema.org Article markup.
- [ ] **OG Image Generation**: Automated social sharing image generation.

### Phase 18b: Legal & Compliance
- [ ] **Terms & Privacy**: Draft and implement basic ToS and Privacy Policy pages.
- [ ] **Cookie Consent**: Add GDPR/CCPA compliant consent banner.
- [ ] **Attribution Standards**: Enforce source attribution guidelines for all content.

### Phase 18c: Content Quality Control
- [ ] **Editorial Workflow**: Define roles (Editor ‚Üí Reviewer ‚Üí Admin) in Directus.
- [ ] **Review Queue**: Create "needs review" dashboard for editors.

---

## TRACK 1: Topics Experience (Unified)

**Goal**: A single, high-performance topic exploration engine. (Merged TRACK 1 & 15)

### Phase 1: Interactive Experience (COMPLETED - Jan 2026)
- [x] **Unified View**: Consolidated `TopicExperience.tsx` as the single entry point for topic exploration.
- [x] **Stable Foundation**: Verified Directus permissions and data integrity for topics/statements.
- [x] **Visual Polish**: Integrated Immersive Hero and background Hebrew watermarks.
- [x] **Navigation**: Implemented scroll-linked tabs and sticky header for section navigation.

### Phase 2: Performance & Disclosure (ACTIVE)
- [ ] **Lazy Loading**: Implement dynamic imports for heavy components (`ConceptConstellation`, `DeepDiveMode`).
- [ ] **Progressive Disclosure**: Refine Level 1-4 depth system (Glance ‚Üí Summary ‚Üí Article ‚Üí Sources).
- [ ] **Mobile UX**: Polish bottom sheet gestures and touch targets for mobile topic study.
- [ ] **LCP Fix**: Optimize image/font loading to improve Lighthouse score from 46 to 80+.

---

## TRACK 2: Search & Discovery (Unified)

**Goal**: Transform search and discovery from redundant pages into a cohesive intentional/passive browsing system. (Merged TRACK 2 & 11)

### Phase 1: Search Foundation (COMPLETED - Dec 2025)
- [x] **API Stabilization**: Optimized `/api/search` for topics, authors, and sources.
- [x] **Mobile UX**: Implemented native-feel bottom sheet for mobile search.
- [x] **Intentional Hubs**: Centralized category browsing in the Topics portal.

### Phase 2: Discovery & Passive Learning (ACTIVE)
- [x] **Zen Mode**: Rebuilt `/explore` as a mobile-first "one quote at a time" discovery interface.
- [ ] **Serendipity Engine**: Surface surprising topic connections based on current study context.
- [ ] **Curated Discovery**: Add editorial controls (`explore_eligible`) to statements collection.
- [ ] **Mobile Polish**: Finalize swipe/pull gestures for "Next Quote" in Zen mode.

---

- [x] Form fields for: canonical_title, description, topic_type, definition_positive, definition_negative
- [x] Save to Directus via API with authentication
- [x] Basic validation and error handling
- [x] Redirect to topic page after save
- [x] Create `/editor/topics` page for topic management with search and filtering

### Phase 5b: Rich Text & Order Management (After Phase 5a) ‚úÖ COMPLETED - Dec 29, 2025
- [x] Add rich-text WYSIWYG for `description` and metadata fields (Markdown/HTML support)
- [x] Build Paragraphs editor with order-key generation (auto-increment LexoRank)
- [x] Build Statements editor with inline topic tagging interface
- [x] Add bulk import/export for JSON files (aligned with DATA_INGESTION_SPEC_v2)
- [x] Test: Editors can structure a full sefer hierarchy and tag statements

### Phase 5c: Translation & Review UI (After Phase 5b) ‚úÖ COMPLETED - Dec 29, 2025
- [x] Add side-by-side translation interface for statements/paragraphs.
- [x] Build review workflow for translation quality levels.
- [x] Add preview mode to see how content renders in frontend.
- [x] Test: Translators can work efficiently and preview changes.

---

## TRACK 6: Editor Refactor (Phase 2 - COMPLETED)

**Goal**: Clean up the codebase now that citation feature is working.

### Phase 2.1: Extract Citation Plugin (COMPLETED)
- [x] Move citation logic from `ProseEditor.tsx` into a self-contained ProseMirror plugin in `components/editor/plugins/citations/`
- [x] Include: cmdk palette, suggestion trigger, node insertion logic
- [x] Update ProseEditor to use the new comprehensive citation plugin
- [x] Test: Citation workflow still works after extraction

### Phase 2.2: Extract `useEditor` Hook (COMPLETED)
- [x] Review current `useEditor` hook implementation
- [x] Consolidate any remaining data-fetching, state management, and save logic from `app/editor/page.tsx`
- [x] Ensure page component is clean and isolated editor logic

---

## ÔøΩ NEW FEATURE PRIORITIES (Jan 2026)

### Editor & Content Management
- [ ] **Hide Entry from Website**: Add toggle to topics to hide from public view.
- [ ] **Topic Version History**: Track and revert content changes.
- [ ] **Auto-Translate**: Integrated AI translation for entry fields.
- [ ] **Language Dropdown**: Improved selection for multi-language editing.
- [ ] **Seder Hishtalshelus Integration**: Make the custom chart component accessible/editable via the editor (not hardcoded).
- [ ] **ISSUE: New Topic Creation**: Debug token/auth issues preventing new topic saves.

### Main Site Enhancements
- [ ] **User Auth**: Sign up/login for community features.
- [ ] **User Collections**: Save and organize personal topic lists.
- [ ] **Full Site Translation**: Support for bilingual navigation and interface.
- [ ] **Enhanced Controls**: User-facing settings for reading experience.
- [ ] **Community Reporting**:
    - [x] Bug report (UI implemented)
    - [ ] Content issue report (detailed workflow)
- [ ] **Advanced Analytics**: Full Google Analytics integration.

### Admin Dashboard (Chassidus Wiki Backend)
#### Content & Branding
- [ ] **CMS Pages**: Edit About, Homepage, and Search Bar text from Admin.
- [ ] **Branding**: Logo upload, color scheme customizer, and font selection.
- [ ] **Site Banners**: Site-wide announcement toggle.
- [ ] **Custom Injection**: CSS/JS injection points for quick fixes.

#### Monitoring & Security
- [ ] **Site Status**: Maintenance mode switch and uptime dashboard.
- [ ] **Logs**: Recent activity log (audit trail) and error log viewer.
- [ ] **Access Control**: Detailed editor permissions and page locking.
- [ ] **Session Management**: Force logout and password policies.
- [ ] **Data Safety**: Backup/Restore functionality and API key management.

#### Performance & Advanced
- [ ] **Technical Ops**: Cache clearing, image optimization, and DB optimization tools.
- [ ] **Growth**: A/B testing manager and webhook configuration.
- [ ] **Publishing**: Multi-language support and scheduled publishing.
- [ ] **Reporting**: Custom report builder and conversion tracking.

---

## ÔøΩüö® INFRASTRUCTURE STATUS (Jan 6, 2026)
- ‚úÖ **Directus Permissions Fix**: Verified static token access and directus-proxy path reconstruction.
- ‚úÖ **API Stability**: Paragraphs and Statements API refactored to use `content_blocks` schema.
- ‚úÖ **Editor Reliability**: Resolved infinite loop in ParagraphsEditor and fixed stuck loading spinner.

---

## TRACK 10: Critical Bug Fixes (COMPLETED - Dec 25, 2025)

**Goal**: Fix critical bugs preventing core functionality from working. **ALL RESOLVED**

### Phase 10a: Seforim Page Recovery (DONE)
- [x] **Diagnose Directus client initialization** - Fixed URL construction in `lib/directus.ts`
- [x] Fix: Used absolute URL for client-side Directus calls.
- [x] Test: `/seforim` loads without error.
- [x] Test: All `/seforim/[seferId]` routes render correctly using `TorahReader`.

### Phase 10b: Search Modal Navigation Fix (DONE)
- [x] **Fix undefined document ID** - Added `.filter(s => s.id)` in mapping.
- [x] Test: Search results navigate to valid pages.
- [x] Test: No `/seforim/undefined` URLs generated.

### Phase 10c: Search Modal Close Button (DONE)
- [x] **Fix mobile close intent** - Added dedicated "Cancel" button to mobile UI.
- [x] Test: Clicking "Cancel" closes modal; `X` clears text.
- [x] Test: Escape key closes modal.

---

## TRACK 11: Seforim Reader Vision (Future - Brainstorming)

**Goal**: Create the best Seforim reader ever. See comprehensive vision docs.

### Key Vision Documents
- **[CHABAD-MAFTEIACH-ROADMAP.md](file:///Users/yitzchok/Documents/Directus/chabad-research/CHABAD-MAFTEIACH-ROADMAP.md)** - 8-phase evolution roadmap
- **[Use cases and persona.MD](file:///Users/yitzchok/Documents/Directus/chabad-research/Documentation/Use%20cases%20and%20persona.MD)** - UX architecture, user flows, device patterns
- **[Seforim-Images-Plan.md](file:///Users/yitzchok/Documents/Directus/chabad-research/Documentation/Seforim-Images-Plan.md)** - Cover images implementation

### Core Principles (from User Research)
1. **Flow-State Preservation** - Never break learning momentum (target: <10 seconds for 90% of lookups)
2. **Boundaries System** - Every concept needs "what it IS" + "what it's NOT"
3. **Progressive Depth** - Level 1 (instant glance) ‚Üí Level 4 (scholarly deep dive)
4. **Device-Aware UX** - Mobile: voice search, offline, sharing; Desktop: multi-tab, shortcuts

### 8-Phase Roadmap Summary
1. Enhanced Reading (typography, themes, bookmarks)
2. Advanced Citations (inter-text linking, networks)
3. Social & Collaborative (annotations, reading groups)
4. AI Analysis (semantic search, concept mapping)
5. Multi-Platform (PWA, mobile apps, offline)
6. Advanced Study (split screen, timeline, network views)
7. Multilingual (Hebrew-English parallel, translation overlays)
8. AI/ML Integration (personalized learning, pattern recognition)

---

## TRACK 12: Scraping & Data Population (The Ingestion Engine)

**Goal**: Automate the ingestion of Chabad Library texts into proper Directus structures.

### Phase 12a: Scraper Refinement
- [ ] Stabilize depth-first traversal for hierarchical books.
- [ ] Implement rate-limit aware sequential processing.
- [ ] Test on large books (e.g. Likkutei Torah).

### Phase 12b: Granular Statement Parsing
- [ ] Implement `parseFootnotesIntoStatements` logic to separate citations from main text.
- [ ] Wire Hebrew folio number conversion (◊ê, ◊ê ‚Üí 1a).
- [ ] Auto-detect language (Hebrew/English) per statement.

### Phase 12c: Bulk Population
- [ ] Create `populate_chabad_book.js` CLI tool for ease of use.
- [ ] Batch insert records to Directus to minimize API overhead.

---

## TRACK 13: Advanced Citation Mapping & Resolution

**Goal**: Turn static citations into a living web of inter-textual links.

### Phase 13a: Citation Extraction
- [ ] Extract structured citation metadata from footnotes.
- [ ] Assign confidence scores based on pattern matching (Book/Folio/Section).
- [ ] Store metadata in `statement.metadata.citation_references`.

### Phase 13b: Deferred Link Resolution
- [ ] Create background job to match extracted citations against newly added books.
- [ ] Update `resolved_link` fields when targets become available.
- [ ] Implement fuzzy matching for book title variations.

### Phase 13c: Interactive Navigation
- [ ] Wire frontend tooltips to show resolved links.
- [ ] Implement "Jump to Source" functionality in the reader.

---

## TRACK 14: Flexible Content Ingestion & AI Smart Detection

**Goal**: Support diverse content types (Bio, Topics, Articles) with intelligent routing.

### Phase 14a: Flexible Mapping
- [ ] Implement multi-type ingestion (Article, Bio, Topic Description, Reference, Metadata).
- [ ] Build validation rules per content type to prevent schema violations.
- [ ] Map frontmatter fields dynamically to Directus collections.

### Phase 14b: Smart detection
- [ ] Use LLM or pattern matching to auto-detect content type during upload.
- [ ] Implement pre-upload validation and "dry-run" mapping preview.

### Phase 14c: Ingestion Analytics
- [ ] Track import history and success rates per user.
- [ ] Build dashboard for ingestion status and error resolution.

---


## TRACK 4: Infrastructure & Testing (Lower priority, do in parallel)

- [x] Decide final Directus public-access model: which collections/fields readable by static token. **DONE** (JWT auth implemented)
- [ ] Implement + test permission changes in staging before production.
- [x] Add integration tests for topics, search, and TorahReader to catch regressions. **FOUNDATION COMPLETE** (Jest setup ready, complex tests deferred)

## TRACK 5: Content Editor & Governance (Unified)

**Goal**: Professional content management with role-based access and review workflows. (Merged TRACK 5, 6, 7)

### Phase 1: Editor Foundation (COMPLETED - Dec 2025)
- [x] **Core Editor**: Built WYSIWYG topic editor with Directus integration.
- [x] **LexoRank**: Implemented order-key generation for paragraphs/statements.
- [x] **Auth Layer**: Secured editor routes behind JWT authentication.

### Phase 2: Review & Governance (ACTIVE)
- [x] **Restricted Insights**: Moved community annotations and feedback to authorized-only views.
- [x] **Review Queue**: Implemented Editorial Review Queue in Admin Dashboard for draft approval.
- [ ] **Versioning**: Add UI to track and revert topic content changes.
- [ ] **Conflict Resolution**: Logic for handling simultaneous edits on the same topic.

---

## Component Cleanup & Maintenance

**Goal**: Reduce technical debt and bundle size. (Ongoing)

1. **[HIGH] Unused Code**: Audit and remove components like `TanyaChapterReader` and `TopicOverview`.
2. **[MEDIUM] Documentation**: Maintain `MIGRATION_WORKFLOW.md` and update README.md setup guides.
3. **[LOW] Lazy Loading**: Continue identifying large components for dynamic imports (current: `ForceGraph`, `DeepDiveMode`).

---

## Execution Status Summary (Jan 25, 2026)

### ‚úÖ FOUNDATION (Weeks 0-1)
- Performance Baseline established (46/100).
- Sentry & Error Boundaries active.
- Directus Permissions & Integrity verified.
- SEO & Legal foundations implemented.

### üöÄ STABILIZATION (Weeks 2-4)
- Redundant tracks consolidated.
- Graph visibility fixed across all topic pages.
- Mobile gestures added to Zen Mode.
- LCP optimizations (Fonts/Lazy Loading) applied.

### üéØ NEXT: INTELLIGENT DISCOVERY (Weeks 5-8)
- Serendipity Engine.
- Semantic Recommendations.
- Advanced study rabbit holes.
